{% extends "hospital_app/base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<h1 class="mb-4">Hospital Dashboard</h1>

<div class="row g-4">
  <div class="col-md-3">
    <div class="card p-3 text-center shadow-sm">
      <h3>{{ patients_count }}</h3>
      <p>Patients</p>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card p-3 text-center shadow-sm">
      <h3>{{ doctors_count }}</h3>
      <p>Doctors</p>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card p-3 text-center shadow-sm">
      <h3>{{ appointments_count }}</h3>
      <p>Appointments</p>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card p-3 text-center shadow-sm">
      <h3>{{ total_revenue }}</h3>
      <p>Total Revenue</p>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-md-6">
    <div class="card p-3 shadow-sm">
      <h5>Appointments per Doctor</h5>
      <canvas id="docChart"></canvas>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card p-3 shadow-sm">
      <h5>Appointments â€” Last 7 days</h5>
      <canvas id="dailyChart"></canvas>
    </div>
  </div>
</div>

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Pass Django data to JS safely -->
{{ doc_labels|json_script:"docLabels" }}
{{ doc_counts|json_script:"docCounts" }}
{{ dates|json_script:"dates" }}
{{ daily_counts|json_script:"dailyCounts" }}

<script>
const docLabels = JSON.parse(document.getElementById('docLabels').textContent);
const docCounts = JSON.parse(document.getElementById('docCounts').textContent);
const dates = JSON.parse(document.getElementById('dates').textContent);
const dailyCounts = JSON.parse(document.getElementById('dailyCounts').textContent);

// Appointments per Doctor (Bar Chart)
const ctxDoc = document.getElementById('docChart').getContext('2d');
new Chart(ctxDoc, {
    type: 'bar',
    data: {
        labels: docLabels,
        datasets: [{
            label: 'Appointments',
            data: docCounts,
            backgroundColor: 'rgba(54, 162, 235, 0.7)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    },
    options: { responsive: true }
});

// Appointments last 7 days (Line Chart)
const ctxDaily = document.getElementById('dailyChart').getContext('2d');
new Chart(ctxDaily, {
    type: 'line',
    data: {
        labels: dates,
        datasets: [{
            label: 'Appointments',
            data: dailyCounts,
            borderColor: 'rgba(255, 99, 132, 1)',
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            fill: false,
            tension: 0.1
        }]
    },
    options: { responsive: true }
});
</script>
{% endblock %}
